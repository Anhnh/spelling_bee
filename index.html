<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spelling Bee Pro - L·ªõp 2</title>
    <style>
        :root { --primary: #4a90e2; --secondary: #f39c12; --success: #2ecc71; --bg: #fdfcf0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 95%; max-width: 850px; text-align: center; border: 4px solid #f1c40f; }
        h1 { color: #d35400; margin-bottom: 5px; }
        .menu-btns { margin-bottom: 20px; display: flex; flex-wrap: wrap; justify-content: center; }
        button { padding: 12px 20px; font-size: 15px; cursor: pointer; border: none; border-radius: 12px; transition: 0.2s; margin: 5px; background: var(--primary); color: white; font-weight: bold; box-shadow: 0 4px #2980b9; }
        button:hover { transform: translateY(-2px); }
        .game-box { display: none; margin-top: 20px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Ch·∫ø ƒë·ªô Luy·ªán t·∫≠p */
        .practice-word { font-size: 40px; color: #2c3e50; margin: 10px 0; text-transform: uppercase; letter-spacing: 5px; }
        .practice-def { font-size: 20px; color: #7f8c8d; font-style: italic; margin-bottom: 20px; padding: 0 20px; }
        .auto-timer { font-size: 14px; color: #e74c3c; font-weight: bold; }

        /* Mic & Thi */
        .word-img { width: 300px; height: 300px; object-fit: contain; border-radius: 15px; background: #fff; border: 2px solid #eee; margin-bottom: 10px; }
        .mic-btn { width: 80px; height: 80px; border-radius: 50%; background: #e74c3c; border: none; color: white; font-size: 30px; cursor: pointer; margin: 20px; box-shadow: 0 4px #c0392b; }
        .mic-btn.listening { background: #2ecc71; animation: pulse 1.5s infinite; box-shadow: 0 0 20px #2ecc71; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        
        .transcript-box { background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0; border: 1px dashed #ccc; min-height: 40px; font-weight: bold; }
        .feedback { font-size: 24px; font-weight: bold; margin-top: 15px; }
        .audio-icon { font-size: 50px; cursor: pointer; color: var(--primary); margin: 10px; display: inline-block; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üêù Spelling Bee Master </h1>
        <div class="menu-btns">
            <button onclick="startPractice()" style="background: #27ae60;">üìñ Trang Luy·ªán T·∫≠p</button>
            <button onclick="startRound(1)" style="background: #3498db;">V√≤ng 1: Nh√¨n Tranh</button>
            <button onclick="startRound(2)" style="background: #9b59b6;">V√≤ng 2: Nghe ƒê·ªãnh Nghƒ©a</button>
        </div>

        <hr style="border: 1px solid #eee; width: 100%;">

        <div id="practice-area" class="game-box">
            <div class="auto-timer" id="practice-timer">T·ª± ƒë·ªông chuy·ªÉn sau: 60s</div>
            <div id="practice-content"></div>
            <button onclick="nextPractice()" style="background: var(--secondary);">T·ª´ ti·∫øp theo ‚ûî</button>
        </div>

        <div id="play-area" class="game-box">
            <h2 id="round-title"></h2>
            <div id="visual-content"></div>
            
            <p id="instruction">Nh·∫•n Mic v√† n√≥i: <b>"Word, W-O-R-D, Word"</b></p>
            
            <button id="mic-btn" class="mic-btn" onclick="toggleListening()">üé§</button>
            <div id="status-text" style="color: #7f8c8d;">B·∫•m mic ƒë·ªÉ n√≥i</div>
            
            <div class="transcript-box" id="transcript-box">Con h√£y n√≥i...</div>
            <div id="feedback" class="feedback"></div>
            <button onclick="nextQuestion()" style="background:#bdc3c7; box-shadow: none; font-size: 13px;">B·ªè qua t·ª´ n√†y</button>
        </div>
    </div>

    <script>
        // Danh s√°ch 80 t·ª´ g·ªëc c·ªßa b·∫°n
        const wordList = [
            {w: "vet", d: "A doctor who takes care of sick animals."},
            {w: "chef", d: "A person who cooks food in a restaurant."},
            {w: "river", d: "A long, flowing body of water that goes to the sea."},
            {w: "cake", d: "A sweet, baked dessert, usually for birthdays."},
            {w: "soda", d: "A sweet, fizzy drink with bubbles."},
            {w: "socks", d: "Clothing you wear on your feet inside shoes."},
            {w: "bank", d: "A place where people keep their money."},
            {w: "milk", d: "A white liquid that comes from cows."},
            {w: "tiger", d: "A large orange wild cat with black stripes."},
            {w: "zebra", d: "An animal that looks like a horse with black and white stripes."},
            {w: "field", d: "A wide area of land with grass."},
            {w: "juice", d: "A drink made from fruits like oranges."},
            {w: "bread", d: "A food made from flour and water, baked in an oven."},
            {w: "sleet", d: "A mix of rain and half-frozen snow."},
            {w: "pizza", d: "Round flat bread with cheese and tomato."},
            {w: "ocean", d: "A very large body of salt water."},
            {w: "gift", d: "Something you give to someone on a special day."},
            {w: "mask", d: "Something you wear to cover your face."},
            {w: "pilot", d: "A person who flies an airplane."},
            {w: "scarf", d: "A cloth you wear around your neck to stay warm."},
            {w: "nurse", d: "A person who helps doctors take care of sick people."},
            {w: "aunt", d: "The sister of your father or mother."},
            {w: "store", d: "A place where you go to buy things."},
            {w: "soccer", d: "A sport where you kick a ball into a goal."},
            {w: "party", d: "A fun gathering to celebrate something."},
            {w: "train", d: "A vehicle that travels on tracks."},
            {w: "salad", d: "A mix of raw vegetables like lettuce."},
            {w: "school", d: "A place where children go to learn."},
            {w: "lizard", d: "A small reptile with a long tail."},
            {w: "desert", d: "A very dry place with lots of sand."},
            {w: "candle", d: "A stick of wax that gives light."},
            {w: "burger", d: "A sandwich with a meat patty inside."},
            {w: "market", d: "A place where people buy and sell food."},
            {w: "sausage", d: "Meat shaped like a tube."},
            {w: "firefighter", d: "A person who puts out fires."},
            {w: "astronaut", d: "A person who travels into space."},
            {w: "hopscotch", d: "A game where you hop into squares."},
            {w: "playground", d: "An outdoor area for children to play."},
            {w: "kangaroo", d: "An animal that hops and has a pouch."},
            {w: "sunglasses", d: "Dark glasses to protect your eyes from the sun."},
            {w: "cousin", d: "The child of your aunt or uncle."},
            {w: "uncle", d: "The brother of your father or mother."},
            {w: "cleaner", d: "A person whose job is to clean buildings."},
            {w: "tennis", d: "A sport played with rackets and a yellow ball."},
            {w: "cheetah", d: "The fastest land animal with spots."},
            {w: "violin", d: "A musical instrument with four strings."},
            {w: "piano", d: "A large instrument with black and white keys."},
            {w: "gloves", d: "Clothing worn on the hands to stay warm."},
            {w: "sweater", d: "A warm piece of clothing for your upper body."},
            {w: "sandals", d: "Light shoes with straps worn in summer."},
            {w: "subway", d: "An underground train system."},
            {w: "whistle", d: "A tool that makes a high sound when blown."},
            {w: "tablet", d: "A small flat computer with a touch screen."},
            {w: "dentist", d: "A doctor for your teeth."},
            {w: "doctor", d: "A person who helps you when you are sick."},
            {w: "factory", d: "A building where things are made by machines."},
            {w: "traffic", d: "Many cars moving on the road."},
            {w: "elephant", d: "A very large grey animal with a trunk."},
            {w: "flower", d: "The colorful part of a plant."},
            {w: "tornado", d: "A strong spinning wind storm."},
            {w: "outback", d: "The wild dry land in Australia."},
            {w: "rainbow", d: "A colorful arch in the sky after rain."},
            {w: "popcorn", d: "A snack made from corn kernels."},
            {w: "morning", d: "The first part of the day."},
            {w: "triangle", d: "A shape with three sides."},
            {w: "evening", d: "The time of day when it gets dark."},
            {w: "diamond", d: "A shape with four sides or a hard gem."},
            {w: "zookeeper", d: "A person who takes care of zoo animals."},
            {w: "birthday", d: "The day you were born."},
            {w: "restaurant", d: "A place where you go to eat meals."},
            {w: "helicopter", d: "An aircraft with spinning blades on top."},
            {w: "aquarium", d: "A place where you see sea animals."},
            {w: "lightning", d: "A flash of electricity in the sky."},
            {w: "mountain", d: "A very high part of the land."},
            {w: "cafeteria", d: "A place in school where students eat."},
            {w: "backpack", d: "A bag you carry on your back."},
            {w: "butterfly", d: "An insect with colorful wings."},
            {w: "chocolate", d: "A sweet brown food from cocoa beans."},
            {w: "rectangle", d: "A shape with four sides like a long square."},
            {w: "afternoon", d: "The time between noon and evening."}
        ];

        let currentRound = 0, currentWord = {}, isListening = false, practiceIdx = 0, practiceTimer;
        let recognition;

        // C·∫•u h√¨nh Nh·∫≠n di·ªán gi·ªçng n√≥i
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                document.getElementById('mic-btn').classList.add('listening');
                document.getElementById('status-text').innerText = "ƒêang nghe...";
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                document.getElementById('transcript-box').innerText = "Con v·ª´a n√≥i: " + transcript;
                validateBeeStyle(transcript);
            };

            recognition.onend = () => {
                isListening = false;
                document.getElementById('mic-btn').classList.remove('listening');
                document.getElementById('status-text').innerText = "B·∫•m ƒë·ªÉ n√≥i l·∫°i";
            };
        }

        // --- CH·∫æ ƒê·ªò LUY·ªÜN T·∫¨P ---
        function startPractice() {
            hideAll();
            document.getElementById('practice-area').style.display = 'block';
            showWordInPractice();
        }

        function showWordInPractice() {
            clearInterval(practiceTimer);
            const wordObj = wordList[practiceIdx];
            const content = document.getElementById('practice-content');
            content.innerHTML = `
                <img src="https://loremflickr.com/400/400/${wordObj.w},cartoon/all" class="word-img">
                <div class="practice-word">${wordObj.w}</div>
                <div class="practice-def">${wordObj.d}</div>
            `;
            
            // ƒê·ªçc t·ª´ v√† ƒë·ªãnh nghƒ©a
            const utter = new SpeechSynthesisUtterance(`${wordObj.w}. ${wordObj.d}`);
            utter.rate = 0.7; utter.lang = 'en-US';
            window.speechSynthesis.speak(utter);

            let timeLeft = 60;
            document.getElementById('practice-timer').innerText = `T·ª± ƒë·ªông chuy·ªÉn sau: ${timeLeft}s`;
            
            practiceTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('practice-timer').innerText = `T·ª± ƒë·ªông chuy·ªÉn sau: ${timeLeft}s`;
                if(timeLeft <= 0) nextPractice();
            }, 1000);
        }

        function nextPractice() {
            practiceIdx = (practiceIdx + 1) % wordList.length;
            showWordInPractice();
        }

        // --- C√ÅC V√íNG THI ---
        function startRound(r) {
            hideAll();
            currentRound = r;
            document.getElementById('play-area').style.display = 'block';
            nextQuestion();
        }

        function nextQuestion() {
            document.getElementById('feedback').innerText = "";
            document.getElementById('transcript-box').innerText = "Con h√£y n√≥i...";
            currentWord = wordList[Math.floor(Math.random() * wordList.length)];

            if (currentRound === 1) {
                document.getElementById('round-title').innerText = "V√≤ng 1: Nh√¨n Tranh ƒêo√°n T·ª´";
                document.getElementById('visual-content').innerHTML = `<img src="https://loremflickr.com/400/400/${currentWord.w},cartoon/all" class="word-img">`;
            } else {
                document.getElementById('round-title').innerText = "V√≤ng 2: Nghe ƒê·ªãnh Nghƒ©a";
                document.getElementById('visual-content').innerHTML = `<div class="audio-icon" onclick="speakJudge()">üîä</div><p>B·∫•m loa nghe ƒë·ªãnh nghƒ©a</p>`;
                speakJudge();
            }
        }

        function speakJudge() {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(`Your word is: ${currentWord.w}. Definition: ${currentWord.d}.`);
            msg.rate = 0.7; msg.lang = 'en-US';
            window.speechSynthesis.speak(msg);
        }

        function toggleListening() {
            if (isListening) recognition.stop();
            else recognition.start();
        }

        // --- X√ÅC TH·ª∞C C·∫§U TR√öC WORD - SPELL - WORD ---
        function validateBeeStyle(transcript) {
            const word = currentWord.w.toLowerCase();
            const letters = word.split('').join(' '); // "t i g e r"
            const f = document.getElementById('feedback');
            
            // Chu·∫©n h√≥a vƒÉn b·∫£n nh·∫≠n di·ªán (x√≥a d·∫•u g·∫°ch ngang, d·∫•u ph·∫©y)
            const cleanTranscript = transcript.replace(/[-]/g, ' ').replace(/[,.]/g, '');

            // Ki·ªÉm tra: Ph·∫£i ch·ª©a t·ª´ √≠t nh·∫•t 2 l·∫ßn v√† ch·ª©a chu·ªói ƒë√°nh v·∫ßn ·ªü gi·ªØa
            // V√≠ d·ª•: "tiger t i g e r tiger"
            const wordCount = (cleanTranscript.match(new RegExp(`\\b${word}\\b`, 'g')) || []).length;
            
            // M·ªôt s·ªë m√°y STT nh·∫≠n di·ªán "T I G E R" th√†nh m·ªôt t·ª´ "tiger" th·ª© hai
            // n√™n ta ki·ªÉm tra xem c√≥ √≠t nh·∫•t 2 l·∫ßn t·ª´ ƒë√≥ xu·∫•t hi·ªán ho·∫∑c t·ª´ ƒë√≥ xu·∫•t hi·ªán v√† ƒë·ªô d√†i chu·ªói ƒë·ªß l·ªõn
            if (wordCount >= 2 || (cleanTranscript.includes(word) && cleanTranscript.length > word.length + 3)) {
                f.innerText = "Ch√≠nh x√°c! Con l√†m r·∫•t t·ªët! üåü";
                f.style.color = "green";
                const praise = new SpeechSynthesisUtterance("Excellent! Correct spelling.");
                praise.rate = 0.8; window.speechSynthesis.speak(praise);
                setTimeout(nextQuestion, 2000);
            } else {
                f.innerText = "Ch∆∞a ƒë√∫ng c·∫•u tr√∫c. Con h√£y n√≥i l·∫°i nh√©!";
                f.style.color = "red";
            }
        }

        function hideAll() {
            document.getElementById('practice-area').style.display = 'none';
            document.getElementById('play-area').style.display = 'none';
            clearInterval(practiceTimer);
            window.speechSynthesis.cancel();
        }
    </script>
</body>
</html>
