<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spelling Bee Master - Luy·ªán Thi L·ªõp 2</title>
    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #f39c12;
            --success: #2ecc71;
            --danger: #e74c3c;
            --bg: #fdfcf0;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
        }

        * { box-sizing: border-box; }

        html, body {
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: #333;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Nav Tabs si√™u g·ªçn */
        .nav-tabs {
            display: flex;
            background: #f1f1f1;
            padding: 4px;
            gap: 4px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #ddd;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 2px;
            font-size: 11px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: transparent;
            color: #777;
            -webkit-tap-highlight-color: transparent;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
            overflow-y: auto;
        }

        #welcome-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
        }

        .game-area { display: none; flex-direction: column; height: 100%; }

        /* Styles chung cho ·∫£nh v√† n·ªôi dung */
        .img-wrapper {
            width: 100%;
            background: #fff;
            border-radius: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .img-display { max-width: 100%; max-height: 35dvh; object-fit: contain; border-radius: 12px; }

        .word-title { font-size: 32px; font-weight: 900; color: var(--text-main); text-transform: uppercase; letter-spacing: 3px; margin: 10px 0; }
        .def-text { font-size: 16px; color: #555; line-height: 1.4; font-style: italic; margin-bottom: 15px; }

        /* H·ªá th·ªëng Countdown */
        .timer-info { 
            font-size: 16px; 
            font-weight: bold; 
            color: var(--danger); 
            margin-bottom: 10px; 
            background: #fff5f5;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #fed7d7;
        }

        #ready-countdown {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 100px; font-weight: bold; color: var(--secondary);
            text-shadow: 0 0 30px rgba(255,255,255,1), 0 0 10px rgba(0,0,0,0.2);
            z-index: 100; display: none;
            pointer-events: none;
        }

        /* Mic & Feedback */
        .mic-section { display: flex; flex-direction: column; align-items: center; margin: 10px 0; }
        .mic-btn {
            width: 85px; height: 85px; border-radius: 50%; border: none;
            background: var(--danger); color: white; font-size: 36px;
            box-shadow: 0 6px #c0392b; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
        }
        .mic-btn.listening { background: var(--success); box-shadow: 0 0 25px var(--success); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .transcript-box {
            background: #f1f4f9; padding: 15px; border-radius: 12px;
            border: 2px dashed #3498db; font-size: 16px; font-weight: bold;
            min-height: 50px; margin: 10px 0; width: 100%; color: #34495e;
            display: flex; align-items: center; justify-content: center;
            text-align: center;
        }

        .feedback-msg { font-size: 20px; font-weight: bold; min-height: 28px; margin: 10px 0; }

        /* V√≤ng 4 Ghi nh·ªõ - ·∫¢nh to g·∫ßn full m√†n h√¨nh */
        .memory-list { 
            display: flex; 
            flex-direction: column; 
            gap: 30px; 
            padding-bottom: 50px;
        }
        .memory-item { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            background: #fff; 
            padding: 15px; 
            border-radius: 20px; 
            border: 2px solid #f0f0f0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .memory-img { 
            width: 100%; 
            height: auto; 
            max-height: 45dvh; 
            object-fit: contain; 
            border-radius: 15px; 
            margin-bottom: 15px;
            background: #fafafa;
        }
        .memory-word { 
            font-size: 32px; 
            font-weight: 900; 
            text-transform: uppercase; 
            color: var(--primary); 
            letter-spacing: 4px;
            margin-bottom: 5px;
        }
        .memory-def {
            font-size: 16px;
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 0 10px;
        }

        .main-btn { width: 100%; padding: 18px; font-size: 18px; font-weight: bold; border: none; border-radius: 15px; color: white; background: var(--primary); box-shadow: 0 5px #2980b9; }
        .main-btn:active { transform: translateY(3px); box-shadow: 0 2px #2980b9; }

        /* Loa to ·ªü V√≤ng 3 */
        .big-speaker { font-size: 100px; color: var(--primary); cursor: pointer; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    </style>
</head>
<body>

    <div class="container">
        <!-- M√†n h√¨nh ch√†o -->
        <div id="welcome-overlay">
            <div style="font-size: 80px;">üêù</div>
            <h1 style="color: #d35400;">Spelling Bee</h1>
            <p>Ch√†o con g√°i y√™u! S·∫µn s√†ng luy·ªán thi ch∆∞a n√†o?</p>
            <button class="main-btn" style="background: var(--success); box-shadow: 0 5px #27ae60;" onclick="startApp()">B·∫ÆT ƒê·∫¶U H·ªåC</button>
        </div>

        <!-- Thanh Tab g·ªçn nh·∫π -->
        <div class="nav-tabs" id="main-nav" style="display: none;">
            <button id="tab-practice" class="tab-btn active" onclick="initPractice()">H·ªåC</button>
            <button id="tab-round1" class="tab-btn" onclick="initRound(1)">V√íNG 1</button>
            <button id="tab-round2" class="tab-btn" onclick="initRound(2)">V√íNG 2</button>
            <button id="tab-round3" class="tab-btn" onclick="initRound(3)">V√íNG 3</button>
            <button id="tab-round4" class="tab-btn" onclick="initRound(4)">V√íNG 4</button>
        </div>

        <div class="content-area">
            <!-- PH·∫¶N H·ªåC (Practice) -->
            <div id="section-practice" class="game-area">
                <div id="practice-timer-text" class="timer-info">Chuy·ªÉn sau: 60s</div>
                <div class="img-wrapper">
                    <img id="p-img" src="" class="img-display">
                    <div style="position:absolute; bottom:15px; right:15px; background:var(--primary); color:white; border-radius:50%; width:50px; height:50px; display:flex; justify-content:center; align-items:center; cursor:pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); border: 2px solid white;" onclick="replayPractice()">üîä</div>
                </div>
                <div id="p-word" class="word-title">---</div>
                <div id="p-def" class="def-text">---</div>
                <button class="main-btn" onclick="manualNextPractice()">T·ª™ TI·∫æP THEO ‚ûî</button>
            </div>

            <!-- PH·∫¶N THI (Rounds 1, 2, 3) -->
            <div id="section-play" class="game-area">
                <div id="round-timer-box" class="timer-info">...</div>
                <div id="round-status-hint" style="font-size: 14px; color: #555; font-weight: bold; margin-bottom: 10px; background: #eef2ff; padding: 5px; border-radius: 5px;"></div>
                
                <div class="img-wrapper">
                    <div id="ready-countdown">3</div>
                    <div id="visual-content" style="width:100%; display:flex; justify-content:center; align-items:center;"></div>
                </div>

                <div class="mic-section" id="mic-container" style="display: none;">
                    <button id="mic-btn" class="mic-btn" onclick="requestSpeech()">üé§</button>
                    <div id="mic-status" style="font-size: 13px; font-weight: bold; color: #777; margin-top: 8px;">B·∫•m ƒë·ªÉ tr·∫£ l·ªùi</div>
                </div>

                <div class="transcript-box" id="transcript-display">...</div>
                <div id="round-feedback" class="feedback-msg"></div>
                <button class="main-btn" style="background:#bdc3c7; box-shadow:none; padding:12px; margin-top:auto;" onclick="nextQuestion()">B·ªé QUA</button>
            </div>

            <!-- PH·∫¶N GHI NH·ªö (Round 4) -->
            <div id="section-memory" class="game-area">
                <div id="memory-timer" class="timer-info" style="font-size: 18px; position: sticky; top: 0; z-index: 10; border-radius: 0 0 15px 15px;">Ghi nh·ªõ trong: 60s</div>
                <div id="memory-list" class="memory-list"></div>
            </div>
        </div>
    </div>

    <script>
        const wordList = [
            {w: "vet", d: "A doctor who takes care of sick animals.", img: "https://www.onlinelogomaker.com/blog/wp-content/uploads/2017/12/vet-logo.jpeg"},
            {w: "chef", d: "A person who cooks food in a restaurant.", img: "https://plus.unsplash.com/premium_vector-1682298101057-5a52c70a669f?q=80&w=866&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"},
            {w: "river", d: "A long, flowing body of water.", img: "https://static.toiimg.com/thumb/116331344/River-destinations-in-India.jpg?width=636&height=358&resize=4"},
            {w: "cake", d: "A sweet baked dessert for birthdays.", img: "https://plus.unsplash.com/premium_photo-1713447395823-2e0b40b75a89?q=80&w=682&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"},
            {w: "soda", d: "A sweet, bubbly drink.", img: "https://images.squarespace-cdn.com/content/v1/5c4b37d2365f0291e539e6bd/1548434619978-XAL2Z552XTDSADA9AHXD/image-asset.jpeg?format=2500w"},
            {w: "socks", d: "You wear these on your feet inside shoes.", img: "https://www.crazysocks.com/cdn/shop/products/rainbow-metallic-socks-small_400x.jpg?v=1595977722"},
            {w: "bank", d: "A place where people keep their money.", img: "https://png.pngtree.com/png-vector/20190115/ourmid/pngtree-regulatory-office-currency-bank-financial-sector-png-image_368241.jpg"},
            {w: "milk", d: "A white drink that comes from cows.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSYbO8jhE0xgrENfXeS6H6K_a08oLL9s5cyeg&s"},
            {w: "tiger", d: "A large orange wild cat with stripes.", img: "https://media.istockphoto.com/id/1420676204/photo/portrait-of-a-royal-bengal-tiger-alert-and-staring-at-the-camera-national-animal-of-bangladesh.jpg?s=612x612&w=0&k=20&c=0OCYv99Ktv3fJ-YYlg7SetHBJj3pIk58WY7GDy5VCtI="},
            {w: "zebra", d: "An animal with black and white stripes.", img: "https://img.freepik.com/free-vector/cute-zebra-cartoon-vector-illustration_1308-180723.jpg?semt=ais_hybrid&w=740&q=80"},
            {w: "field", d: "A wide area of land with grass.", img: "https://media.istockphoto.com/id/1421187500/photo/a-field-of-corn-at-dusk.jpg?s=612x612&w=0&k=20&c=Mv220j7hl1_pX1SvViqk3noNJPF1SkDZQiBDX1gO44w="},
            {w: "juice", d: "A drink made from fruits like oranges.", img: "https://media.istockphoto.com/id/158268808/photo/fresh-citrus-juices.jpg?s=612x612&w=0&k=20&c=vflsrO3KXXtWfpOOzNZdBVgeIpLy21-OSUl-QPSgPmU="},
            {w: "bread", d: "A food made from flour and baked.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOfoIt9rHlWEvEQlIJpYLyUMEpOttn_Q9nEQ&s"},
            {w: "sleet", d: "A mix of rain and frozen snow.", img: "https://cdn.britannica.com/67/123867-050-9D287BC3/Sleet-ground.jpg"},
            {w: "pizza", d: "A round bread with cheese and tomato.", img: "https://img.freepik.com/free-photo/pizza-pizza-filled-with-tomatoes-salami-olives_140725-1200.jpg?semt=ais_hybrid&w=740&q=80"},
            {w: "ocean", d: "A very large body of salt water.", img: "https://www.greenpeace.org/static/planet4-aotearoa-stateless/2023/11/07eba586-gp1t6j5o_web_size.jpg"},
            {w: "gift", d: "Something you give on a special day.", img: "https://images.pexels.com/photos/264787/pexels-photo-264787.jpeg?cs=srgb&dl=pexels-pixabay-264787.jpg&fm=jpg"},
            {w: "mask", d: "Something you wear to cover your face.", img: "https://dictionary.cambridge.org/vi/images/thumb/mask_noun_002_22549.jpg?version=6.0.71"},
            {w: "pilot", d: "A person who flies an airplane.", img: "https://media.istockphoto.com/id/2152453318/photo/confident-female-pilot-by-private-jet.jpg?s=612x612&w=0&k=20&c=gFRL-_1Jm5L-cgCpB90k7tSSq6LjwaXjl-OLB_PtpqU="},
            {w: "scarf", d: "A cloth you wear to stay warm.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNFR_eLICJEddavF5FSe2uwxw4gr8jfzoJyw&s"},
            {w: "nurse", d: "A person who helps sick people.", img: "https://media.vov.vn/sites/default/files/styles/large/public/2022-05/3621_dieu_duong.jpg"},
            {w: "aunt", d: "The sister of your father or mother.", img: "https://i.postimg.cc/TPCPXfsY/Screenshot-2026-01-30-at-13-18-37.png"},
            {w: "store", d: "A place where you go to buy things.", img: "https://static.vecteezy.com/system/resources/previews/041/641/848/non_2x/shop-store-icon-storefront-building-supermarket-shopping-symbol-flat-illustration-vector.jpg"},
            {w: "soccer", d: "A sport where you kick a ball.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT84p2do_-aVUPAjNRqDQ1xsMyOIskyAXy0TA&s"},
            {w: "party", d: "A fun gathering to celebrate.", img: "https://static.vecteezy.com/system/resources/previews/012/744/356/non_2x/cartoon-kids-party-poster-with-big-table-sweets-and-gifts-in-birthday-celebration-illustration-vector.jpg"},
            {w: "train", d: "A vehicle that travels on tracks.", img: "https://media.istockphoto.com/id/466506979/photo/indian-passenger-train.jpg?s=612x612&w=0&k=20&c=AKcMyvqsam93AnADQaK4hzAMI9bdWOVd8tKoF5Sf10M="},
            {w: "salad", d: "A mix of raw vegetables.", img: "https://png.pngtree.com/png-vector/20240913/ourmid/pngtree-salad-png-image_12807016.png"},
            {w: "school", d: "A place where children go to learn.", img: "https://scontent.fhan5-9.fna.fbcdn.net/v/t39.30808-6/465927299_9497212406973727_8825375467049598245_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeFJr1RJHVlvimY0wLSwDokWP5Em_46VzNU_kSb_jpXM1aKtUK4IbfAvgwKh9gG3hqbqWlGFLfn5PKDUxaSx6C-e&_nc_ohc=LMvo7tNapMgQ7kNvwEb-WKS&_nc_oc=AdkHDz4Z_o71G5lZK8RHTQFuclRO-FMP84SkvWO66nwac9aekrLTisRLlvhx1r94SpY&_nc_zt=23&_nc_ht=scontent.fhan5-9.fna&_nc_gid=Upe8v3gPYGCyYqUIm_Dp3A&oh=00_AfpXaQpsvcMdWw-9FfW8xIDwMJ8FLAEbDjZRWqKSanF7Ow&oe=698222B2"},
            {w: "lizard", d: "A small reptile with a long tail.", img: "https://i.pinimg.com/736x/fb/86/c7/fb86c7e0ecb7104a5e4c11b5fa212920.jpg"},
            {w: "desert", d: "A very dry place with lots of sand.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRN99JwgRDUW5uGqUIVIlb0hvs31FAW6zdi4w&s"},
            {w: "candle", d: "A stick of wax that gives light.", img: "https://www.shutterstock.com/shutterstock/videos/1107230139/thumb/7.jpg?ip=x480"},
            {w: "burger", d: "A sandwich with a meat patty.", img: "https://img.freepik.com/free-psd/hand-drawn-burger-illustration_23-2151600197.jpg?semt=ais_hybrid&w=740&q=80"},
            {w: "market", d: "A place where people buy food.", img: "https://media.istockphoto.com/id/482806537/vector/market.jpg?s=612x612&w=0&k=20&c=AxYKwT2mH4aCumgTpqbQXtojjNlN4pUNbmuePwDFvPY="},
            {w: "sausage", d: "Meat shaped like a long tube.", img: "https://img.freepik.com/free-vector/hand-drawn-meat-cartoon-illustration_23-2150621184.jpg?semt=ais_hybrid&w=740&q=80"},
            {w: "firefighter", d: "A person who puts out fires.", img: "https://static.vecteezy.com/system/resources/previews/047/783/187/non_2x/a-cartoon-firefighter-wearing-a-red-helmet-and-uniform-is-using-a-hose-to-put-out-a-fire-he-is-smiling-and-appears-to-be-happy-to-be-doing-his-job-free-vector.jpg"},
            {w: "astronaut", d: "A person who travels into space.", img: "https://www.shutterstock.com/image-vector/cute-cartoon-astronaut-riding-rocket-600nw-2497377733.jpg"},
            {w: "hopscotch", d: "A game where you hop into squares.", img: "https://static.vecteezy.com/system/resources/thumbnails/046/972/785/small/children-playing-hopscotch-game-illustration-on-a-white-background-vector.jpg"},
            {w: "playground", d: "An outdoor area for children to play.", img: "https://img.freepik.com/premium-vector/kids-playground-with-tube-slide-climbing-ladder-seesaw-cartoon-landscape_338371-730.jpg?w=360"},
            {w: "kangaroo", d: "An animal that hops and has a pouch.", img: "https://thumbs.dreamstime.com/b/cheerful-animated-kangaroo-hopping-australian-landscape-joey-cheerful-animated-kangaroo-hopping-363413866.jpg"},
            {w: "sunglasses", d: "Dark glasses to protect your eyes.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQvP8Ml3WI3zNNG7qIqOt6KQxfLLC1eUtEoGQ&s"},
            {w: "cousin", d: "The child of your aunt or uncle.", img: "https://i.postimg.cc/T2g20VcD/Screenshot-2026-01-30-at-13-39-03.png"},
            {w: "uncle", d: "The brother of your father or mother.", img: "https://i.postimg.cc/5tLKT2Kg/uncle.jpg"},
            {w: "cleaner", d: "A person whose job is to clean.", img: "https://thumbs.dreamstime.com/b/cleaning-service-concept-cheerful-cartoon-character-cleaner-woman-holds-dust-brush-lady-vector-illustration-isolated-white-148174676.jpg"},
            {w: "tennis", d: "A sport with rackets and a yellow ball.", img: "https://media.istockphoto.com/id/1001099474/vector/vector-illustration-of-kid-playing-tennis.jpg?s=612x612&w=0&k=20&c=zwKWXVuuhtNNYHaSyToM9dQ4Mi4svwB8WFBK9_-UJlc="},
            {w: "cheetah", d: "The fastest land animal with spots.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSDLtCfh_-sjnar-06y2Q0R_GDniFmZrUoqcA&s"},
            {w: "violin", d: "A musical instrument with strings.", img: "https://t3.ftcdn.net/jpg/01/97/07/90/360_F_197079022_PcMRgJwfRkolM2en0ZRkZxyT3wl7OL5d.jpg"},
            {w: "piano", d: "A large instrument with black/white keys.", img: "https://i.pinimg.com/736x/3c/47/b0/3c47b085ac28aee07d1140819a0c6ad4.jpg"},
            {w: "gloves", d: "Clothing worn on the hands.", img: "https://png.pngtree.com/png-clipart/20190517/original/pngtree-cartoon-glove-shape-gloves-cartoon-gloves-glove-pattern-png-image_3822899.jpg"},
            {w: "sweater", d: "Warm clothing for your upper body.", img: "https://i.pinimg.com/736x/b6/28/09/b62809cf00394ab94fc0db7b729d0e1d.jpg"},
            {w: "sandals", d: "Light shoes worn in summer.", img: "https://img.freepik.com/premium-vector/adorable-cartoon-sandals-pink-blue-yellow-illustration_1324823-13193.jpg"},
            {w: "subway", d: "An underground train system.", img: "https://t4.ftcdn.co/jpg/03/23/03/35/360_F_323033547_KxnAz5lDWCWqkBicfH7glG9Kinv7WSsh.jpg"},
            {w: "whistle", d: "A tool that makes a high sound.", img: "https://thumbs.dreamstime.com/b/businessman-coach-blow-whistle-concept-illustration-figure-80735055.jpg"},
            {w: "tablet", d: "A small flat computer with touch.", img: "https://t4.ftcdn.co/jpg/01/32/82/83/360_F_132828382_znWmJkHEwfJszVgU3E7B31plJsMzRERH.jpg"},
            {w: "dentist", d: "A doctor for your teeth.", img: "https://media.istockphoto.com/id/914817876/vector/doctor-with-happy-healthy-teeth-vector-illustration.jpg?s=612x612&w=0&k=20&c=7vtPzkyKAPG6ITGT-fchWTe8tn-X2Pi2w70VWlkJKxk="},
            {w: "doctor", d: "A person who helps sick people.", img: "https://www.shutterstock.com/image-vector/male-doctor-smiling-selfconfidence-flat-600nw-2281709217.jpg"},
            {w: "factory", d: "A building where things are made.", img: "https://img.freepik.com/free-vector/city-drains-flat-background-with-factory-urban-landscape-river-pollution-illustration_1284-62760.jpg?semt=ais_hybrid&w=740&q=80"},
            {w: "traffic", d: "Many cars moving on the road.", img: "https://img.freepik.com/free-vector/red-traffic-light-flat-illustration_1284-22959.jpg?semt=ais_hybrid&w=740&q=80"},
            {w: "elephant", d: "A very large animal with a trunk.", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRfET-rB-9jLqphCYaZ7smAeImBWKTHrqAe8A&s"},
            {w: "flower", d: "The colorful part of a plant.", img: "https://png.pngtree.com/png-vector/20250821/ourmid/pngtree-cartoon-bouquet-of-colorful-flowers-clipart-png-image_17261274.png"},
            {w: "tornado", d: "A strong spinning wind storm.", img: "https://img.freepik.com/free-vector/hand-drawn-tornado-cartoon-illustration_23-2150597821.jpg?semt=ais_hybrid&w=740&q=80"},
            {w: "outback", d: "Wild dry land in Australia.", img: "https://www.shutterstock.com/image-vector/australian-desert-natural-landscape-beautiful-600nw-2583595329.jpg"},
            {w: "rainbow", d: "A colorful arch in the sky.", img: "https://i.pinimg.com/564x/48/63/8b/48638bbee73ecccbbd77bb78661b023b.jpg"},
            {w: "popcorn", d: "A snack made from corn.", img: "https://img.freepik.com/premium-vector/cartoon-illustration-popcorn-with-smiling-face-smiling-face_481747-94392.jpg"},
            {w: "morning", d: "The first part of the day.", img: "https://www.shutterstock.com/shutterstock/videos/1058940629/thumb/1.jpg"},
            {w: "triangle", d: "A shape with three sides.", img: "https://www.shutterstock.com/image-vector/mascot-illustration-triangle-showing-three-260nw-413888398.jpg"},
            {w: "evening", d: "The time when it gets dark.", img: "https://img.freepik.com/free-vector/spooky-night-forest-background-with-full-moon_1308-78373.jpg?semt=ais_hybrid&w=740&q=80"},
            {w: "diamond", d: "A shape with 4 sides or a gem.", img: "https://img.freepik.com/premium-vector/cute-diamonds-sparkling-fine-jewelry-cartoon-vector_1022901-114374.jpg?w=360"},
            {w: "zookeeper", d: "A person who cares for zoo animals.", img: "https://en.pimg.jp/101/742/111/1/101742111.jpg"},
            {w: "birthday", d: "The day you were born.", img: "https://www.shutterstock.com/shutterstock/videos/3624383843/thumb/10.jpg?ip=x480"},
            {w: "restaurant", d: "A place where you eat meals.", img: "https://static.vecteezy.com/system/resources/thumbnails/046/295/316/small_2x/people-sit-and-eat-dinner-in-a-restaurant-2d-animation-free-video.jpg"},
            {w: "helicopter", d: "An aircraft with spinning blades.", img: "https://www.shutterstock.com/shutterstock/videos/3565979903/thumb/1.jpg?ip=x480"},
            {w: "aquarium", d: "A place where you see sea animals.", img: "https://c8.alamy.com/comp/2PT10Y3/aquarium-template-hand-drawn-cartoon-flat-illustration-with-family-and-kids-looking-at-underwater-fish-sea-animals-variety-marine-flora-and-fauna-2PT10Y3.jpg"},
            {w: "lightning", d: "A flash of light in the sky.", img: "https://thumbs.dreamstime.com/b/animation-lightning-striking-electric-discharge-impact-place-magical-energy-flash-yellow-isolated-transparent-315158166.jpg"},
            {w: "mountain", d: "A very high part of the land.", img: "https://img.freepik.com/premium-vector/cartoon-illustration-mountain-with-trees-mountains_135595-114419.jpg"},
            {w: "cafeteria", d: "A place in school where you eat.", img: "https://media.istockphoto.com/id/534274095/vector/kids-eating-at-the-school-cafeteria.jpg?s=612x612&w=0&k=20&c=hSCxZl9HWq0eSgxpbmQXphfj9lZ675oiCU3hu9oodCI="},
            {w: "backpack", d: "A bag you carry on your back.", img: "https://media.istockphoto.com/id/885237532/vector/nice-purple-orange-back-pack.jpg?s=612x612&w=0&k=20&c=9OPeSV0hXKhmoprR-NpEc7GD4vrOSB-eiUqz0HYD6rM="},
            {w: "butterfly", d: "An insect with colorful wings.", img: "https://media.gettyimages.com/id/472301363/vector/monarch-butterfly.jpg?s=612x612&w=gi&k=20&c=1LQh1cvRHe9694E3XEg3gWvoS9bOhFcTXY93ECS1LT8="},
            {w: "chocolate", d: "A sweet brown food from cocoa.", img: "https://media.istockphoto.com/id/1352752888/vector/funny-cartoon-chocolate-bar-with-blue-paper-wrapping.jpg?s=612x612&w=0&k=20&c=xyrOUsG8gWDeVbfp8I-IbLiaMUe9apBNMsIFhxAX0WQ="},
            {w: "rectangle", d: "A shape like a long square.", img: "https://classroomclipart.com/image/static2/preview2/rectangle-shape-cartoon-character-clipart-28342.jpg"},
            {w: "afternoon", d: "The time between noon and evening.", img: "https://static.vecteezy.com/system/resources/previews/000/413/623/non_2x/vector-a-sunset-view-with-a-boy-running.jpg"}
        ];

        let currentMode = ''; 
        let currentWord = {};
        let practiceList = []; 
        let practiceIdx = 0;
        let autoNextInterval;
        let isListening = false;
        let recognition;
        let silenceTimer; 
        let fullTranscript = "";
        let roundTimer; 
        let readyCountdownInterval;

        // C·∫•u h√¨nh Speech Recognition
        if ('webkitSpeechRecognition' in window || 'speechRecognition' in window) {
            const SpeechRecognition = window.webkitSpeechRecognition || window.speechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                fullTranscript = "";
                document.getElementById('mic-btn').classList.add('listening');
                document.getElementById('mic-status').innerText = "ƒêang nghe...";
                document.getElementById('transcript-display').innerText = "M√°y ƒëang l·∫Øng nghe con...";
            };

            recognition.onresult = (event) => {
                clearTimeout(silenceTimer);
                let interimTranscript = "";
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        fullTranscript += event.results[i][0].transcript + " ";
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                const displayTranscript = (fullTranscript + interimTranscript).toLowerCase();
                
                // ·ªû V√≤ng 1, ·∫©n transcript khi ƒëang n√≥i
                if (currentMode !== 'round1') {
                    document.getElementById('transcript-display').innerText = "Con n√≥i: " + displayTranscript;
                }
                
                silenceTimer = setTimeout(() => {
                    if (isListening) {
                        recognition.stop();
                        // Sau khi d·ª´ng m·ªõi hi·ªán vƒÉn b·∫£n cho V√≤ng 1
                        document.getElementById('transcript-display').innerText = "Con n√≥i: " + displayTranscript;
                        validateSpeech(displayTranscript);
                    }
                }, 3500); 
            };

            recognition.onend = () => {
                isListening = false;
                document.getElementById('mic-btn').classList.remove('listening');
                document.getElementById('mic-status').innerText = "B·∫•m Mic ƒë·ªÉ n√≥i l·∫°i";
            };
        }

        function startApp() {
            document.getElementById('welcome-overlay').style.display = 'none';
            document.getElementById('main-nav').style.display = 'flex';
            initPractice();
        }

        function hideAll() {
            document.querySelectorAll('.game-area').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            clearInterval(autoNextInterval);
            clearInterval(roundTimer);
            clearInterval(readyCountdownInterval);
            clearTimeout(silenceTimer);
            window.speechSynthesis.cancel();
            if (recognition && isListening) recognition.stop();
            document.getElementById('ready-countdown').style.display = 'none';
        }

        function shuffleArray(array) {
            let shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // --- LUY·ªÜN T·∫¨P ---
        function initPractice() {
            hideAll();
            currentMode = 'practice';
            document.getElementById('tab-practice').classList.add('active');
            practiceList = shuffleArray(wordList); 
            practiceIdx = 0;
            document.getElementById('section-practice').style.display = 'flex';
            renderPractice();
        }

        function renderPractice() {
            clearInterval(autoNextInterval);
            const item = practiceList[practiceIdx];
            document.getElementById('p-img').src = item.img;
            document.getElementById('p-word').innerText = item.w;
            document.getElementById('p-def').innerText = item.d;

            replayPractice();

            let timeLeft = 60;
            const progress = document.getElementById('practice-progress');
            progress.style.width = '100%';

            autoNextInterval = setInterval(() => {
                timeLeft--;
                progress.style.width = (timeLeft / 60 * 100) + '%';
                document.getElementById('practice-timer-text').innerText = `T·ª± ƒë·ªông chuy·ªÉn sau: ${timeLeft}s`;
                if (timeLeft <= 0) manualNextPractice();
            }, 1000);
        }

        function replayPractice() {
            window.speechSynthesis.cancel();
            const item = practiceList[practiceIdx];
            speakText(`${item.w}. ${item.d}`, 0.5);
        }

        function manualNextPractice() {
            practiceIdx = (practiceIdx + 1) % practiceList.length;
            renderPractice();
        }

        // --- C√ÅC V√íNG THI ---
        function initRound(round) {
            hideAll();
            currentMode = 'round' + round;
            document.getElementById('tab-round' + round).classList.add('active');
            
            if (round === 4) {
                document.getElementById('section-memory').style.display = 'flex';
                startRound4();
            } else {
                document.getElementById('section-play').style.display = 'flex';
                nextQuestion();
            }
        }

        function nextQuestion() {
            clearInterval(roundTimer);
            document.getElementById('round-feedback').innerText = "";
            document.getElementById('transcript-display').innerText = "...";
            document.getElementById('mic-container').style.display = 'none';
            document.getElementById('ready-countdown').style.display = 'none';

            currentWord = wordList[Math.floor(Math.random() * wordList.length)];
            const visual = document.getElementById('visual-content');
            const hintBox = document.getElementById('round-status-hint');

            if (currentMode === 'round1') {
                document.getElementById('round-title').innerText = "V√≤ng 1: Nh√¨n Tranh";
                visual.innerHTML = `<img src="${currentWord.img}" class="img-display">`;
                hintBox.innerText = "Chu·∫©n b·ªã... 5s ƒë·ªÉ b·∫•m Mic!";
                startCountdown(5, () => {
                    document.getElementById('mic-container').style.display = 'flex';
                }, () => {
                    forceSkip("H·∫øt th·ªùi gian b·∫•m Mic!");
                });
            } else if (currentMode === 'round2') {
                document.getElementById('round-title').innerText = "V√≤ng 2: ƒê·ªçc Quiz";
                visual.innerHTML = `<div style="font-size:22px; line-height:1.6; color:var(--text-main); padding:20px; font-weight:bold; background:#fff9e6; border-radius:15px; border:2px solid #ffeeba; text-align:center; width:100%;">${currentWord.d}</div>`;
                hintBox.innerText = "Con c√≥ 30s ƒë·ªÉ ƒë·ªçc c√¢u ƒë·ªë!";
                startCountdown(30, () => {
                    document.getElementById('mic-container').style.display = 'flex';
                }, () => {
                    forceSkip("H·∫øt 30s ƒë·ªçc ƒë·ªë!");
                });
            } else if (currentMode === 'round3') {
                document.getElementById('round-title').innerText = "V√≤ng 3: Nghe & ƒêo√°n";
                visual.innerHTML = `<div class="big-speaker" onclick="speakJudge()">üîä</div>`;
                hintBox.innerText = "ƒêang l·∫Øng nghe gi√°m kh·∫£o...";
                window.speechSynthesis.cancel();
                const msg = new SpeechSynthesisUtterance(`Your word is: ${currentWord.d}`);
                msg.rate = 0.5;
                msg.onend = () => {
                    hintBox.innerText = "Gi√°m kh·∫£o ƒë·ªçc xong! 10s b·∫•m Mic!";
                    startCountdown(10, () => {
                        document.getElementById('mic-container').style.display = 'flex';
                    }, () => {
                        forceSkip("H·∫øt 10s suy nghƒ©!");
                    });
                };
                window.speechSynthesis.speak(msg);
            }
        }

        function startCountdown(seconds, onStart, onEnd) {
            if (onStart) onStart();
            let timeLeft = seconds;
            document.getElementById('round-timer-box').innerText = `Th·ªùi gian: ${timeLeft}s`;
            
            roundTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('round-timer-box').innerText = `Th·ªùi gian: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(roundTimer);
                    if (onEnd) onEnd();
                }
            }, 1000);
        }

        function requestSpeech() {
            clearInterval(roundTimer);
            document.getElementById('mic-container').style.display = 'none';
            const countdownEl = document.getElementById('ready-countdown');
            countdownEl.style.display = 'block';
            let count = 3;
            countdownEl.innerText = count;
            
            readyCountdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.innerText = count;
                } else {
                    clearInterval(readyCountdownInterval);
                    countdownEl.style.display = 'none';
                    document.getElementById('mic-container').style.display = 'flex';
                    toggleSpeech();
                }
            }, 1000);
        }

        function forceSkip(msg) {
            document.getElementById('round-feedback').innerText = msg + " Nh∆∞·ªùng quy·ªÅn tr·∫£ l·ªùi.";
            document.getElementById('round-feedback').style.color = "red";
            document.getElementById('mic-container').style.display = 'none';
            speakText("Time is up!", 0.5);
            setTimeout(nextQuestion, 3500);
        }

        function toggleSpeech() {
            if (!recognition) return;
            if (isListening) {
                clearTimeout(silenceTimer);
                recognition.stop();
            } else {
                recognition.start();
                silenceTimer = setTimeout(() => {
                    if (isListening && fullTranscript === "") {
                        recognition.stop();
                        forceSkip("Con ch∆∞a n√≥i g√¨.");
                    }
                }, 4000);
            }
        }

        function validateSpeech(transcript) {
            const word = currentWord.w.toLowerCase();
            const feedback = document.getElementById('round-feedback');
            const cleanTranscript = transcript.replace(/[^a-z]/g, ' ').trim();
            const wordsArray = cleanTranscript.split(/\s+/);
            const keywordOccurrences = wordsArray.filter(v => v === word).length;
            
            if (keywordOccurrences >= 2 || (transcript.includes(word) && transcript.length > word.length + 4)) {
                feedback.innerText = "CH√çNH X√ÅC! TUY·ªÜT V·ªúI üåü";
                feedback.style.color = "green";
                speakText("Excellent!", 0.5);
                setTimeout(nextQuestion, 2500);
            } else {
                feedback.innerText = "C·ªë l√™n, ƒë·ªçc ƒë√∫ng c·∫•u tr√∫c con nh√©!";
                feedback.style.color = "red";
            }
        }

        // --- V√íNG 4: GHI NH·ªö ---
        function startRound4() {
            const listEl = document.getElementById('memory-list');
            listEl.innerHTML = "";
            const sample = shuffleArray(wordList).slice(0, 10);
            
            sample.forEach(item => {
                const div = document.createElement('div');
                div.className = "memory-item";
                div.innerHTML = `
                    <img src="${item.img}" class="memory-img">
                    <div class="memory-word">${item.w}</div>
                    <div class="memory-def">${item.d}</div>
                `;
                listEl.appendChild(div);
            });

            let timeLeft = 60;
            const timerEl = document.getElementById('memory-timer');
            timerEl.innerText = `Ghi nh·ªõ danh s√°ch n√†y: ${timeLeft}s`;

            // T·ª± ƒë·ªông cu·ªôn l√™n ƒë·∫ßu khi b·∫Øt ƒë·∫ßu v√≤ng 4
            document.querySelector('.content-area').scrollTo({ top: 0, behavior: 'smooth' });

            roundTimer = setInterval(() => {
                timeLeft--;
                timerEl.innerText = `Ghi nh·ªõ danh s√°ch n√†y: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(roundTimer);
                    timerEl.innerText = "H·∫æT GI·ªú! CON H√ÉY N√ìI L·∫†I C√ÅC T·ª™";
                    listEl.style.display = "none";
                    speakText("Time is up. Now say the words you remembered.", 0.5);
                }
            }, 1000);
        }

        function speakText(text, rate) {
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'en-US';
            utter.rate = rate;
            window.speechSynthesis.speak(utter);
        }

        function speakJudge() {
            window.speechSynthesis.cancel();
            speakText(`Your word is: ${currentWord.d}`, 0.5);
        }

    </script>
</body>
</html>
