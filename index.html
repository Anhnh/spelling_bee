<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spelling Bee Voice Master</title>
    <style>
        :root { --primary: #4a90e2; --secondary: #f39c12; --success: #2ecc71; --bg: #fdfcf0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 95%; max-width: 800px; text-align: center; border: 4px solid #f1c40f; }
        h1 { color: #d35400; margin-bottom: 5px; }
        .menu-btns { margin-bottom: 25px; }
        button { padding: 14px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 12px; transition: 0.2s; margin: 8px; background: var(--primary); color: white; font-weight: bold; box-shadow: 0 4px #2980b9; }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px #2980b9; }
        .game-box { display: none; margin-top: 20px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .word-img { width: 320px; height: 320px; object-fit: contain; border-radius: 15px; background: #fff; border: 2px solid #eee; margin-bottom: 10px; }
        
        /* Mic Styles */
        .mic-btn { width: 80px; height: 80px; border-radius: 50%; background: #e74c3c; border: none; color: white; font-size: 30px; cursor: pointer; margin: 20px; box-shadow: 0 4px #c0392b; position: relative; }
        .mic-btn.listening { background: #2ecc71; box-shadow: 0 0 20px #2ecc71; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        
        .status-text { font-size: 18px; color: #7f8c8d; height: 24px; margin-top: 10px; }
        .transcript-box { background: #f0f0f0; padding: 15px; border-radius: 10px; margin: 15px 0; min-height: 40px; color: #34495e; font-weight: bold; border: 1px dashed #ccc; }
        .feedback { font-size: 24px; font-weight: bold; margin-top: 20px; }
        .audio-icon { font-size: 50px; cursor: pointer; color: var(--primary); margin: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üêù Spelling Bee Voice üêù</h1>
        <p>Con h√£y n√≥i theo c·∫•u tr√∫c: <b>T·ª´ - ƒê√°nh v·∫ßn - T·ª´</b></p>
        
        <div class="menu-btns">
            <button onclick="startRound(1)" style="background: #3498db;">V√≤ng 1: Nh√¨n Tranh</button>
            <button onclick="startRound(2)" style="background: #9b59b6;">V√≤ng 2: Nghe Gi√°m Kh·∫£o</button>
        </div>

        <div id="play-area" class="game-box">
            <h2 id="round-title"></h2>
            <div id="visual-content"></div>
            
            <p>B·∫•m Mic v√† n√≥i: <i>"Tiger, T-I-G-E-R, Tiger"</i></p>
            
            <button id="mic-btn" class="mic-btn" onclick="toggleListening()">üé§</button>
            <div class="status-text" id="status-text">B·∫•m ƒë·ªÉ b·∫Øt ƒë·∫ßu n√≥i</div>
            
            <div class="transcript-box" id="transcript-box">M√°y ƒëang nghe: ...</div>
            
            <button onclick="nextQuestion()" style="background:#bdc3c7;">B·ªè qua t·ª´ n√†y</button>
            <div id="feedback" class="feedback"></div>
        </div>
    </div>

    <script>
        const wordList = [
            {w: "vet", d: "A doctor who takes care of sick animals."},
            {w: "chef", d: "A person who cooks food in a restaurant."},
            {w: "river", d: "A long, flowing body of water that goes to the sea."},
            {w: "cake", d: "A sweet, baked dessert, usually for birthdays."},
            {w: "soda", d: "A sweet, fizzy drink with lots of bubbles."},
            {w: "socks", d: "Clothing that you wear on your feet, inside your shoes."},
            {w: "bank", d: "A safe place where people keep and save their money."},
            {w: "milk", d: "A healthy, white liquid that comes from cows."},
            {w: "tiger", d: "A large, orange wild cat with black stripes."},
            {w: "zebra", d: "An animal that looks like a horse with black and white stripes."},
            {w: "field", d: "A wide area of open land covered with grass."},
            {w: "juice", d: "A tasty drink made by squeezing fresh fruits."},
            {w: "bread", d: "A common food made from flour and baked in an oven."},
            {w: "sleet", d: "A cold mix of falling rain and half-frozen snow."},
            {w: "pizza", d: "A round, flat bread topped with cheese and tomato sauce."},
            {w: "ocean", d: "A very large body of salt water that covers the Earth."},
            {w: "gift", d: "Something special that you give to someone as a present."},
            {w: "mask", d: "A face covering used for protection or a costume."},
            {w: "pilot", d: "A person who flies a plane or a helicopter."},
            {w: "scarf", d: "A piece of cloth worn around the neck to stay warm."},
            {w: "nurse", d: "A person who helps the doctor to care for patients."},
            {w: "aunt", d: "The sister of your mother or your father."},
            {w: "store", d: "A shop where you can go to buy things you need."},
            {w: "soccer", d: "A sport where players kick a ball into a goal."},
            {w: "party", d: "A fun celebration with friends and family."},
            {w: "train", d: "A vehicle that carries people along a metal track."},
            {w: "salad", d: "A healthy mix of cold, raw vegetables."},
            {w: "school", d: "A place where children go to learn from teachers."},
            {w: "lizard", d: "A small reptile with a long tail and scaly skin."},
            {w: "desert", d: "A very dry and sandy land with very little water."},
            {w: "candle", d: "A stick of wax that you light to get a small flame."},
            {w: "burger", d: "A round sandwich with a meat patty inside a bun."},
            {w: "market", d: "A place where people buy and sell fresh food."},
            {w: "sausage", d: "Meat that is ground up and shaped like a long tube."},
            {w: "firefighter", d: "A brave person who puts out fires to save people."},
            {w: "astronaut", d: "A person who is trained to travel into outer space."},
            {w: "hopscotch", d: "A playground game where you hop into numbered squares."},
            {w: "playground", d: "An outdoor area for children to play and have fun."},
            {w: "kangaroo", d: "An animal from Australia that hops and has a pouch."},
            {w: "sunglasses", d: "Dark glasses that protect your eyes from the sun."},
            {w: "cousin", d: "The child of your aunt or your uncle."},
            {w: "uncle", d: "The brother of your mother or your father."},
            {w: "cleaner", d: "A person whose job is to wash and tidy up buildings."},
            {w: "tennis", d: "A sport played with rackets and a small yellow ball."},
            {w: "cheetah", d: "A large, spotted cat that is the fastest land animal."},
            {w: "violin", d: "A musical instrument with four strings played with a bow."},
            {w: "piano", d: "A large instrument with black and white keys."},
            {w: "gloves", d: "Clothing worn on the hands to keep them warm."},
            {w: "sweater", d: "A warm, knitted piece of clothing for your upper body."},
            {w: "sandals", d: "Light, open shoes with straps worn in summer."},
            {w: "subway", d: "An underground train system in a big city."},
            {w: "whistle", d: "A small tool that makes a loud, high sound when blown."},
            {w: "tablet", d: "A small, flat computer with a touch screen."},
            {w: "dentist", d: "A doctor who takes care of your teeth."},
            {w: "doctor", d: "A person who helps you when you feel sick."},
            {w: "factory", d: "A big building where things are made by machines."},
            {w: "traffic", d: "Many cars and trucks moving on the road at once."},
            {w: "elephant", d: "A very large, grey animal with a long trunk."},
            {w: "flower", d: "The colorful and beautiful part of a plant."},
            {w: "tornado", d: "A very strong and spinning wind storm."},
            {w: "outback", d: "The wild and dry areas of Australia."},
            {w: "rainbow", d: "A colorful arch in the sky after it rains."},
            {w: "popcorn", d: "A snack made from corn that pops when heated."},
            {w: "morning", d: "The early part of the day when the sun comes up."},
            {w: "triangle", d: "A shape that has three sides and three corners."},
            {w: "evening", d: "The time of day when it starts to get dark."},
            {w: "diamond", d: "A shape with four sides or a very shiny stone."},
            {w: "zookeeper", d: "A person who takes care of animals in a zoo."},
            {w: "birthday", d: "The special day of the year when you were born."},
            {w: "restaurant", d: "A place where you pay to sit and eat a meal."},
            {w: "helicopter", d: "An aircraft that flies using spinning blades on top."},
            {w: "aquarium", d: "A place where you see sea creatures."},
            {w: "lightning", d: "A bright flash of electricity in the sky."},
            {w: "mountain", d: "A very high part of the Earth's surface."},
            {w: "cafeteria", d: "A room in a school where students eat lunch."},
            {w: "backpack", d: "A bag you wear on your back to carry books."},
            {w: "butterfly", d: "An insect with four large and colorful wings."},
            {w: "chocolate", d: "A sweet, brown food made from cocoa beans."},
            {w: "rectangle", d: "A shape with four sides like a long square."},
            {w: "afternoon", d: "The time of day between lunch and evening."}
        ];

        let currentRound = 0, currentWord = {}, isListening = false;
        let recognition;

        // C√†i ƒë·∫∑t Nh·∫≠n di·ªán Gi·ªçng n√≥i
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                document.getElementById('mic-btn').classList.add('listening');
                document.getElementById('status-text').innerText = "ƒêang nghe con n√≥i...";
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                document.getElementById('transcript-box').innerText = "M√°y nghe ƒë∆∞·ª£c: " + transcript;
                validateSpeech(transcript);
            };

            recognition.onerror = () => { stopMic(); };
            recognition.onend = () => { stopMic(); };
        }

        function stopMic() {
            isListening = false;
            document.getElementById('mic-btn').classList.remove('listening');
            document.getElementById('status-text').innerText = "B·∫•m Mic ƒë·ªÉ n√≥i l·∫°i";
        }

        function toggleListening() {
            if (isListening) recognition.stop();
            else recognition.start();
        }

        function startRound(r) {
            currentRound = r;
            document.getElementById('play-area').style.display = 'block';
            nextQuestion();
        }

        function nextQuestion() {
            document.getElementById('feedback').innerText = "";
            document.getElementById('transcript-box').innerText = "M√°y ƒëang nghe: ...";
            currentWord = wordList[Math.floor(Math.random() * wordList.length)];

            if (currentRound === 1) {
                document.getElementById('round-title').innerText = "V√≤ng 1: Nh√¨n Tranh";
                document.getElementById('visual-content').innerHTML = `<img src="https://loremflickr.com/400/400/${currentWord.w},cartoon/all" class="word-img">`;
            } else {
                document.getElementById('round-title').innerText = "V√≤ng 2: Nghe Gi√°m Kh·∫£o";
                document.getElementById('visual-content').innerHTML = `<div class="audio-icon" onclick="speakJudge()">üîä</div><p>B·∫•m loa nghe ƒë·ªãnh nghƒ©a</p>`;
                speakJudge();
            }
        }

        function speakJudge() {
            window.speechSynthesis.cancel();
            // C·∫•u tr√∫c: Your word is... Definition...
            const msg = `Your word is: ${currentWord.w}. Definition: ${currentWord.d}.`;
            const utter = new SpeechSynthesisUtterance(msg);
            utter.rate = 0.7;
            utter.lang = 'en-US';
            window.speechSynthesis.speak(utter);
        }

        function validateSpeech(text) {
            const word = currentWord.w.toLowerCase();
            const f = document.getElementById('feedback');
            
            // Logic ki·ªÉm tra th√¥ng minh:
            // V√¨ STT th∆∞·ªùng nh·∫≠n di·ªán "T-I-G-E-R" th√†nh t·ª´ "tiger" 
            // n√™n ta ki·ªÉm tra xem trong c√¢u n√≥i c√≥ ch·ª©a t·ª´ kh√≥a √≠t nh·∫•t 2 l·∫ßn ho·∫∑c ch·ª©a t·ª´ kh√≥a + ch·ªØ c√°i kh√¥ng
            const cleanedText = text.replace(/[^a-z]/g, ''); // X√≥a kho·∫£ng tr·∫Øng v√† d·∫•u
            
            if (text.includes(word)) {
                f.innerText = "Tuy·ªát v·ªùi! Con gi·ªèi l·∫Øm! ‚ú®";
                f.style.color = "green";
                
                const praise = new SpeechSynthesisUtterance("Excellent!");
                praise.rate = 0.9;
                window.speechSynthesis.speak(praise);
                
                setTimeout(nextQuestion, 2000);
            } else {
                f.innerText = "M√°y ch∆∞a nghe r√µ, con th·ª≠ l·∫°i nh√©!";
                f.style.color = "orange";
            }
        }
    </script>
</body>
</html>
